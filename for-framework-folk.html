<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>testtools for framework folk &mdash; testtools VERSION documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'VERSION',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="testtools VERSION documentation" href="index.html" />
    <link rel="next" title="Contributing to testtools" href="hacking.html" />
    <link rel="prev" title="testtools for test authors" href="for-test-authors.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="hacking.html" title="Contributing to testtools"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="for-test-authors.html" title="testtools for test authors"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">testtools VERSION documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="testtools-for-framework-folk">
<h1>testtools for framework folk<a class="headerlink" href="#testtools-for-framework-folk" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>In addition to having many features <a class="reference internal" href="for-test-authors.html"><em>for test authors</em></a>, testtools also has many bits and pieces that are useful
for folk who write testing frameworks.</p>
<p>If you are the author of a test runner, are working on a very large
unit-tested project, are trying to get one testing framework to play nicely
with another or are hacking away at getting your test suite to run in parallel
over a heterogenous cluster of machines, this guide is for you.</p>
<p>This manual is a summary. You can get details by consulting the
<a class="reference internal" href="api.html"><em>testtools API docs</em></a>.</p>
</div>
<div class="section" id="extensions-to-testcase">
<h2>Extensions to TestCase<a class="headerlink" href="#extensions-to-testcase" title="Permalink to this headline">¶</a></h2>
<p>In addition to the <tt class="docutils literal"><span class="pre">TestCase</span></tt> specific methods, we have extensions for
<tt class="docutils literal"><span class="pre">TestSuite</span></tt> that also apply to <tt class="docutils literal"><span class="pre">TestCase</span></tt> (because <tt class="docutils literal"><span class="pre">TestCase</span></tt> and
<tt class="docutils literal"><span class="pre">TestSuite</span></tt> follow the Composite pattern).</p>
<div class="section" id="custom-exception-handling">
<h3>Custom exception handling<a class="headerlink" href="#custom-exception-handling" title="Permalink to this headline">¶</a></h3>
<p>testtools provides a way to control how test exceptions are handled.  To do
this, add a new exception to <tt class="docutils literal"><span class="pre">self.exception_handlers</span></tt> on a
<tt class="docutils literal"><span class="pre">testtools.TestCase</span></tt>.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="bp">self</span><span class="o">.</span><span class="n">exception_handlers</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">ExceptionClass</span><span class="p">,</span> <span class="n">handler</span><span class="p">))</span><span class="o">.</span>
</pre></div>
</div>
<p>Having done this, if any of <tt class="docutils literal"><span class="pre">setUp</span></tt>, <tt class="docutils literal"><span class="pre">tearDown</span></tt>, or the test method raise
<tt class="docutils literal"><span class="pre">ExceptionClass</span></tt>, <tt class="docutils literal"><span class="pre">handler</span></tt> will be called with the test case, test result
and the raised exception.</p>
<p>Use this if you want to add a new kind of test result, that is, if you think
that <tt class="docutils literal"><span class="pre">addError</span></tt>, <tt class="docutils literal"><span class="pre">addFailure</span></tt> and so forth are not enough for your needs.</p>
</div>
<div class="section" id="controlling-test-execution">
<h3>Controlling test execution<a class="headerlink" href="#controlling-test-execution" title="Permalink to this headline">¶</a></h3>
<p>If you want to control more than just how exceptions are raised, you can
provide a custom <tt class="docutils literal"><span class="pre">RunTest</span></tt> to a <tt class="docutils literal"><span class="pre">TestCase</span></tt>.  The <tt class="docutils literal"><span class="pre">RunTest</span></tt> object can
change everything about how the test executes.</p>
<p>To work with <tt class="docutils literal"><span class="pre">testtools.TestCase</span></tt>, a <tt class="docutils literal"><span class="pre">RunTest</span></tt> must have a factory that
takes a test and an optional list of exception handlers and an optional
last_resort handler.  Instances returned by the factory must have a <tt class="docutils literal"><span class="pre">run()</span></tt>
method that takes an optional <tt class="docutils literal"><span class="pre">TestResult</span></tt> object.</p>
<p>The default is <tt class="docutils literal"><span class="pre">testtools.runtest.RunTest</span></tt>, which calls <tt class="docutils literal"><span class="pre">setUp</span></tt>, the test
method, <tt class="docutils literal"><span class="pre">tearDown</span></tt> and clean ups (see <a class="reference internal" href="for-test-authors.html#addcleanup"><em>addCleanup</em></a>) in the normal, vanilla
way that Python&#8217;s standard <a class="reference external" href="http://docs.python.org/library/unittest.html">unittest</a> does.</p>
<p>To specify a <tt class="docutils literal"><span class="pre">RunTest</span></tt> for all the tests in a <tt class="docutils literal"><span class="pre">TestCase</span></tt> class, do something
like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SomeTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="n">run_tests_with</span> <span class="o">=</span> <span class="n">CustomRunTestFactory</span>
</pre></div>
</div>
<p>To specify a <tt class="docutils literal"><span class="pre">RunTest</span></tt> for a specific test in a <tt class="docutils literal"><span class="pre">TestCase</span></tt> class, do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SomeTests</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="nd">@run_test_with</span><span class="p">(</span><span class="n">CustomRunTestFactory</span><span class="p">,</span> <span class="n">extra_arg</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">foo</span><span class="o">=</span><span class="s">&#39;whatever&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>In addition, either of these can be overridden by passing a factory in to the
<tt class="docutils literal"><span class="pre">TestCase</span></tt> constructor with the optional <tt class="docutils literal"><span class="pre">runTest</span></tt> argument.</p>
</div>
<div class="section" id="test-renaming">
<h3>Test renaming<a class="headerlink" href="#test-renaming" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">testtools.clone_test_with_new_id</span></tt> is a function to copy a test case
instance to one with a new name.  This is helpful for implementing test
parameterization.</p>
</div>
<div class="section" id="delayed-test-failure">
<span id="force-failure"></span><h3>Delayed Test Failure<a class="headerlink" href="#delayed-test-failure" title="Permalink to this headline">¶</a></h3>
<p>Setting the <tt class="docutils literal"><span class="pre">testtools.TestCase.force_failure</span></tt> instance variable to True will
cause <tt class="docutils literal"><span class="pre">testtools.RunTest</span></tt> to fail the test case after the test has finished.
This is useful when you want to cause a test to fail, but don&#8217;t want to
prevent the remainder of the test code from being executed.</p>
</div>
<div class="section" id="exception-formatting">
<h3>Exception formatting<a class="headerlink" href="#exception-formatting" title="Permalink to this headline">¶</a></h3>
<p>Testtools <tt class="docutils literal"><span class="pre">TestCase</span></tt> instances format their own exceptions. The attribute
<tt class="docutils literal"><span class="pre">__testtools_tb_locals__</span></tt> controls whether to include local variables in the
formatted exceptions.</p>
</div>
</div>
<div class="section" id="test-placeholders">
<h2>Test placeholders<a class="headerlink" href="#test-placeholders" title="Permalink to this headline">¶</a></h2>
<p>Sometimes, it&#8217;s useful to be able to add things to a test suite that are not
actually tests.  For example, you might wish to represents import failures
that occur during test discovery as tests, so that your test result object
doesn&#8217;t have to do special work to handle them nicely.</p>
<p>testtools provides two such objects, called &#8220;placeholders&#8221;: <tt class="docutils literal"><span class="pre">PlaceHolder</span></tt>
and <tt class="docutils literal"><span class="pre">ErrorHolder</span></tt>.  <tt class="docutils literal"><span class="pre">PlaceHolder</span></tt> takes a test id and an optional
description.  When it&#8217;s run, it succeeds.  <tt class="docutils literal"><span class="pre">ErrorHolder</span></tt> takes a test id,
and error and an optional short description.  When it&#8217;s run, it reports that
error.</p>
<p>These placeholders are best used to log events that occur outside the test
suite proper, but are still very relevant to its results.</p>
<p>e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">suite</span> <span class="o">=</span> <span class="n">TestSuite</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">suite</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">PlaceHolder</span><span class="p">(</span><span class="s">&#39;I record an event&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">suite</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">TextTestResult</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
<span class="go">I record an event                                                   [OK]</span>
</pre></div>
</div>
</div>
<div class="section" id="test-instance-decorators">
<h2>Test instance decorators<a class="headerlink" href="#test-instance-decorators" title="Permalink to this headline">¶</a></h2>
<div class="section" id="decoratetestcaseresult">
<h3>DecorateTestCaseResult<a class="headerlink" href="#decoratetestcaseresult" title="Permalink to this headline">¶</a></h3>
<p>This object calls out to your code when <tt class="docutils literal"><span class="pre">run</span></tt> / <tt class="docutils literal"><span class="pre">__call__</span></tt> are called and
allows the result object that will be used to run the test to be altered. This
is very useful when working with a test runner that doesn&#8217;t know your test case
requirements. For instance, it can be used to inject a <tt class="docutils literal"><span class="pre">unittest2</span></tt> compatible
adapter when someone attempts to run your test suite with a <tt class="docutils literal"><span class="pre">TestResult</span></tt> that
does not support <tt class="docutils literal"><span class="pre">addSkip</span></tt> or other <tt class="docutils literal"><span class="pre">unittest2</span></tt> methods. Similarly it can
aid the migration to <tt class="docutils literal"><span class="pre">StreamResult</span></tt>.</p>
<p>e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">suite</span> <span class="o">=</span> <span class="n">TestSuite</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">suite</span> <span class="o">=</span> <span class="n">DecorateTestCaseResult</span><span class="p">(</span><span class="n">suite</span><span class="p">,</span> <span class="n">ExtendedToOriginalDecorator</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="extensions-to-testresult">
<h2>Extensions to TestResult<a class="headerlink" href="#extensions-to-testresult" title="Permalink to this headline">¶</a></h2>
<div class="section" id="streamresult">
<h3>StreamResult<a class="headerlink" href="#streamresult" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">StreamResult</span></tt> is a new API for dealing with test case progress that supports
concurrent and distributed testing without the various issues that
<tt class="docutils literal"><span class="pre">TestResult</span></tt> has such as buffering in multiplexers.</p>
<p>The design has several key principles:</p>
<ul class="simple">
<li>Nothing that requires up-front knowledge of all tests.</li>
<li>Deal with tests running in concurrent environments, potentially distributed
across multiple processes (or even machines). This implies allowing multiple
tests to be active at once, supplying time explicitly, being able to
differentiate between tests running in different contexts and removing any
assumption that tests are necessarily in the same process.</li>
<li>Make the API as simple as possible - each aspect should do one thing well.</li>
</ul>
<p>The <tt class="docutils literal"><span class="pre">TestResult</span></tt> API this is intended to replace has three different clients.</p>
<ul class="simple">
<li>Each executing <tt class="docutils literal"><span class="pre">TestCase</span></tt> notifies the <tt class="docutils literal"><span class="pre">TestResult</span></tt> about activity.</li>
<li>The testrunner running tests uses the API to find out whether the test run
had errors, how many tests ran and so on.</li>
<li>Finally, each <tt class="docutils literal"><span class="pre">TestCase</span></tt> queries the <tt class="docutils literal"><span class="pre">TestResult</span></tt> to see whether the test
run should be aborted.</li>
</ul>
<p>With <tt class="docutils literal"><span class="pre">StreamResult</span></tt> we need to be able to provide a <tt class="docutils literal"><span class="pre">TestResult</span></tt> compatible
adapter (<tt class="docutils literal"><span class="pre">StreamToExtendedDecorator</span></tt>) to allow incremental migration.
However, we don&#8217;t need to conflate things long term. So - we define three
separate APIs, and merely mix them together to provide the
<tt class="docutils literal"><span class="pre">StreamToExtendedDecorator</span></tt>. <tt class="docutils literal"><span class="pre">StreamResult</span></tt> is the first of these APIs -
meeting the needs of <tt class="docutils literal"><span class="pre">TestCase</span></tt> clients. It handles events generated by
running tests. See the API documentation for <tt class="docutils literal"><span class="pre">testtools.StreamResult</span></tt> for
details.</p>
</div>
<div class="section" id="streamsummary">
<h3>StreamSummary<a class="headerlink" href="#streamsummary" title="Permalink to this headline">¶</a></h3>
<p>Secondly we define the <tt class="docutils literal"><span class="pre">StreamSummary</span></tt> API which takes responsibility for
collating errors, detecting incomplete tests and counting tests. This provides
a compatible API with those aspects of <tt class="docutils literal"><span class="pre">TestResult</span></tt>. Again, see the API
documentation for <tt class="docutils literal"><span class="pre">testtools.StreamSummary</span></tt>.</p>
</div>
<div class="section" id="testcontrol">
<h3>TestControl<a class="headerlink" href="#testcontrol" title="Permalink to this headline">¶</a></h3>
<p>Lastly we define the <tt class="docutils literal"><span class="pre">TestControl</span></tt> API which is used to provide the
<tt class="docutils literal"><span class="pre">shouldStop</span></tt> and <tt class="docutils literal"><span class="pre">stop</span></tt> elements from <tt class="docutils literal"><span class="pre">TestResult</span></tt>. Again, see the API
documentation for <tt class="docutils literal"><span class="pre">testtools.TestControl</span></tt>. <tt class="docutils literal"><span class="pre">TestControl</span></tt> can be paired with
a <tt class="docutils literal"><span class="pre">StreamFailFast</span></tt> to trigger aborting a test run when a failure is observed.
Aborting multiple workers in a distributed environment requires hooking
whatever signalling mechanism the distributed environment has up to a
<tt class="docutils literal"><span class="pre">TestControl</span></tt> in each worker process.</p>
</div>
<div class="section" id="streamtagger">
<h3>StreamTagger<a class="headerlink" href="#streamtagger" title="Permalink to this headline">¶</a></h3>
<p>A <tt class="docutils literal"><span class="pre">StreamResult</span></tt> filter that adds or removes tags from events:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">testtools</span> <span class="kn">import</span> <span class="n">StreamTagger</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sink</span> <span class="o">=</span> <span class="n">StreamResult</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">StreamTagger</span><span class="p">([</span><span class="n">sink</span><span class="p">],</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;add&#39;</span><span class="p">]),</span> <span class="nb">set</span><span class="p">([</span><span class="s">&#39;discard&#39;</span><span class="p">]))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">startTestRun</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Run tests against result here.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">stopTestRun</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="streamtodict">
<h3>StreamToDict<a class="headerlink" href="#streamtodict" title="Permalink to this headline">¶</a></h3>
<p>A simplified API for dealing with <tt class="docutils literal"><span class="pre">StreamResult</span></tt> streams. Each test is
buffered until it completes and then reported as a trivial dict. This makes
writing analysers very easy - you can ignore all the plumbing and just work
with the result. e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">testtools</span> <span class="kn">import</span> <span class="n">StreamToDict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">handle_test</span><span class="p">(</span><span class="n">test_dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span><span class="p">(</span><span class="n">test_dict</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">StreamToDict</span><span class="p">(</span><span class="n">handle_test</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">startTestRun</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Run tests against result here.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># At stopTestRun() any incomplete buffered tests are announced.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span><span class="o">.</span><span class="n">stopTestRun</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="extendedtostreamdecorator">
<h3>ExtendedToStreamDecorator<a class="headerlink" href="#extendedtostreamdecorator" title="Permalink to this headline">¶</a></h3>
<p>This is a hybrid object that combines both the <tt class="docutils literal"><span class="pre">Extended</span></tt> and <tt class="docutils literal"><span class="pre">Stream</span></tt>
<tt class="docutils literal"><span class="pre">TestResult</span></tt> APIs into one class, but only emits <tt class="docutils literal"><span class="pre">StreamResult</span></tt> events.
This is useful when a <tt class="docutils literal"><span class="pre">StreamResult</span></tt> stream is desired, but you cannot
be sure that the tests which will run have been updated to the <tt class="docutils literal"><span class="pre">StreamResult</span></tt>
API.</p>
</div>
<div class="section" id="streamtoextendeddecorator">
<h3>StreamToExtendedDecorator<a class="headerlink" href="#streamtoextendeddecorator" title="Permalink to this headline">¶</a></h3>
<p>This is a simple converter that emits the <tt class="docutils literal"><span class="pre">ExtendedTestResult</span></tt> API in
response to events from the <tt class="docutils literal"><span class="pre">StreamResult</span></tt> API. Useful when outputting
<tt class="docutils literal"><span class="pre">StreamResult</span></tt> events from a <tt class="docutils literal"><span class="pre">TestCase</span></tt> but the supplied <tt class="docutils literal"><span class="pre">TestResult</span></tt>
does not support the <tt class="docutils literal"><span class="pre">status</span></tt> and <tt class="docutils literal"><span class="pre">file</span></tt> methods.</p>
</div>
<div class="section" id="streamtoqueue">
<h3>StreamToQueue<a class="headerlink" href="#streamtoqueue" title="Permalink to this headline">¶</a></h3>
<p>This is a <tt class="docutils literal"><span class="pre">StreamResult</span></tt> decorator for reporting tests from multiple threads
at once. Each method submits an event to a supplied Queue object as a simple
dict. See <tt class="docutils literal"><span class="pre">ConcurrentStreamTestSuite</span></tt> for a convenient way to use this.</p>
</div>
<div class="section" id="timestampingstreamresult">
<h3>TimestampingStreamResult<a class="headerlink" href="#timestampingstreamresult" title="Permalink to this headline">¶</a></h3>
<p>This is a <tt class="docutils literal"><span class="pre">StreamResult</span></tt> decorator for adding timestamps to events that lack
them. This allows writing the simplest possible generators of events and
passing the events via this decorator to get timestamped data. As long as
no buffering/queueing or blocking happen before the timestamper sees the event
the timestamp will be as accurate as if the original event had it.</p>
</div>
<div class="section" id="streamresultrouter">
<h3>StreamResultRouter<a class="headerlink" href="#streamresultrouter" title="Permalink to this headline">¶</a></h3>
<p>This is a <tt class="docutils literal"><span class="pre">StreamResult</span></tt> which forwards events to an arbitrary set of target
<tt class="docutils literal"><span class="pre">StreamResult</span></tt> objects. Events that have no forwarding rule are passed onto
an fallback <tt class="docutils literal"><span class="pre">StreamResult</span></tt> for processing. The mapping can be changed at
runtime, allowing great flexibility and responsiveness to changes. Because
The mapping can change dynamically and there could be the same recipient for
two different maps, <tt class="docutils literal"><span class="pre">startTestRun</span></tt> and <tt class="docutils literal"><span class="pre">stopTestRun</span></tt> handling is fine
grained and up to the user.</p>
<p>If no fallback has been supplied, an unroutable event will raise an exception.</p>
<p>For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">router</span> <span class="o">=</span> <span class="n">StreamResultRouter</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sink</span> <span class="o">=</span> <span class="n">doubles</span><span class="o">.</span><span class="n">StreamResult</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">router</span><span class="o">.</span><span class="n">add_rule</span><span class="p">(</span><span class="n">sink</span><span class="p">,</span> <span class="s">&#39;route_code_prefix&#39;</span><span class="p">,</span> <span class="n">route_prefix</span><span class="o">=</span><span class="s">&#39;0&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">consume_route</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">router</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="n">test_id</span><span class="o">=</span><span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="n">route_code</span><span class="o">=</span><span class="s">&#39;0/1&#39;</span><span class="p">,</span> <span class="n">test_status</span><span class="o">=</span><span class="s">&#39;uxsuccess&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Would remove the <tt class="docutils literal"><span class="pre">0/</span></tt> from the route_code and forward the event like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sink</span><span class="o">.</span><span class="n">status</span><span class="p">(</span><span class="s">&#39;test_id=foo&#39;</span><span class="p">,</span> <span class="n">route_code</span><span class="o">=</span><span class="s">&#39;1&#39;</span><span class="p">,</span> <span class="n">test_status</span><span class="o">=</span><span class="s">&#39;uxsuccess&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>See <tt class="docutils literal"><span class="pre">pydoc</span> <span class="pre">testtools.StreamResultRouter</span></tt> for details.</p>
</div>
<div class="section" id="testresult-addskip">
<h3>TestResult.addSkip<a class="headerlink" href="#testresult-addskip" title="Permalink to this headline">¶</a></h3>
<p>This method is called on result objects when a test skips. The
<tt class="docutils literal"><span class="pre">testtools.TestResult</span></tt> class records skips in its <tt class="docutils literal"><span class="pre">skip_reasons</span></tt> instance
dict. The can be reported on in much the same way as succesful tests.</p>
</div>
<div class="section" id="testresult-time">
<h3>TestResult.time<a class="headerlink" href="#testresult-time" title="Permalink to this headline">¶</a></h3>
<p>This method controls the time used by a <tt class="docutils literal"><span class="pre">TestResult</span></tt>, permitting accurate
timing of test results gathered on different machines or in different threads.
See pydoc testtools.TestResult.time for more details.</p>
</div>
<div class="section" id="threadsafeforwardingresult">
<h3>ThreadsafeForwardingResult<a class="headerlink" href="#threadsafeforwardingresult" title="Permalink to this headline">¶</a></h3>
<p>A <tt class="docutils literal"><span class="pre">TestResult</span></tt> which forwards activity to another test result, but synchronises
on a semaphore to ensure that all the activity for a single test arrives in a
batch. This allows simple TestResults which do not expect concurrent test
reporting to be fed the activity from multiple test threads, or processes.</p>
<p>Note that when you provide multiple errors for a single test, the target sees
each error as a distinct complete test.</p>
</div>
<div class="section" id="multitestresult">
<h3>MultiTestResult<a class="headerlink" href="#multitestresult" title="Permalink to this headline">¶</a></h3>
<p>A test result that dispatches its events to many test results.  Use this
to combine multiple different test result objects into one test result object
that can be passed to <tt class="docutils literal"><span class="pre">TestCase.run()</span></tt> or similar.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">()</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">()</span>
<span class="n">combined</span> <span class="o">=</span> <span class="n">MultiTestResult</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="n">combined</span><span class="o">.</span><span class="n">startTestRun</span><span class="p">()</span>  <span class="c"># Calls a.startTestRun() and b.startTestRun()</span>
</pre></div>
</div>
<p>Each of the methods on <tt class="docutils literal"><span class="pre">MultiTestResult</span></tt> will return a tuple of whatever the
component test results return.</p>
</div>
<div class="section" id="testresultdecorator">
<h3>TestResultDecorator<a class="headerlink" href="#testresultdecorator" title="Permalink to this headline">¶</a></h3>
<p>Not strictly a <tt class="docutils literal"><span class="pre">TestResult</span></tt>, but something that implements the extended
<tt class="docutils literal"><span class="pre">TestResult</span></tt> interface of testtools.  It can be subclassed to create objects
that wrap <tt class="docutils literal"><span class="pre">TestResults</span></tt>.</p>
</div>
<div class="section" id="texttestresult">
<h3>TextTestResult<a class="headerlink" href="#texttestresult" title="Permalink to this headline">¶</a></h3>
<p>A <tt class="docutils literal"><span class="pre">TestResult</span></tt> that provides a text UI very similar to the Python standard
library UI. Key differences are that its supports the extended outcomes and
details API, and is completely encapsulated into the result object, permitting
it to be used without a &#8216;TestRunner&#8217; object. Not all the Python 2.7 outcomes
are displayed (yet). It is also a &#8216;quiet&#8217; result with no dots or verbose mode.
These limitations will be corrected soon.</p>
</div>
<div class="section" id="extendedtooriginaldecorator">
<h3>ExtendedToOriginalDecorator<a class="headerlink" href="#extendedtooriginaldecorator" title="Permalink to this headline">¶</a></h3>
<p>Adapts legacy <tt class="docutils literal"><span class="pre">TestResult</span></tt> objects, such as those found in older Pythons, to
meet the testtools <tt class="docutils literal"><span class="pre">TestResult</span></tt> API.</p>
</div>
<div class="section" id="test-doubles">
<h3>Test Doubles<a class="headerlink" href="#test-doubles" title="Permalink to this headline">¶</a></h3>
<p>In testtools.testresult.doubles there are three test doubles that testtools
uses for its own testing: <tt class="docutils literal"><span class="pre">Python26TestResult</span></tt>, <tt class="docutils literal"><span class="pre">Python27TestResult</span></tt>,
<tt class="docutils literal"><span class="pre">ExtendedTestResult</span></tt>. These TestResult objects implement a single variation of
the TestResult API each, and log activity to a list <tt class="docutils literal"><span class="pre">self._events</span></tt>. These are
made available for the convenience of people writing their own extensions.</p>
</div>
<div class="section" id="starttestrun-and-stoptestrun">
<h3>startTestRun and stopTestRun<a class="headerlink" href="#starttestrun-and-stoptestrun" title="Permalink to this headline">¶</a></h3>
<p>Python 2.7 added hooks <tt class="docutils literal"><span class="pre">startTestRun</span></tt> and <tt class="docutils literal"><span class="pre">stopTestRun</span></tt> which are called
before and after the entire test run. &#8216;stopTestRun&#8217; is particularly useful for
test results that wish to produce summary output.</p>
<p><tt class="docutils literal"><span class="pre">testtools.TestResult</span></tt> provides default <tt class="docutils literal"><span class="pre">startTestRun</span></tt> and <tt class="docutils literal"><span class="pre">stopTestRun</span></tt>
methods, and he default testtools runner will call these methods
appropriately.</p>
<p>The <tt class="docutils literal"><span class="pre">startTestRun</span></tt> method will reset any errors, failures and so forth on
the result, making the result object look as if no tests have been run.</p>
</div>
</div>
<div class="section" id="extensions-to-testsuite">
<h2>Extensions to TestSuite<a class="headerlink" href="#extensions-to-testsuite" title="Permalink to this headline">¶</a></h2>
<div class="section" id="concurrenttestsuite">
<h3>ConcurrentTestSuite<a class="headerlink" href="#concurrenttestsuite" title="Permalink to this headline">¶</a></h3>
<p>A TestSuite for parallel testing. This is used in conjuction with a helper that
runs a single suite in some parallel fashion (for instance, forking, handing
off to a subprocess, to a compute cloud, or simple threads).
ConcurrentTestSuite uses the helper to get a number of separate runnable
objects with a run(result), runs them all in threads using the
ThreadsafeForwardingResult to coalesce their activity.</p>
</div>
<div class="section" id="concurrentstreamtestsuite">
<h3>ConcurrentStreamTestSuite<a class="headerlink" href="#concurrentstreamtestsuite" title="Permalink to this headline">¶</a></h3>
<p>A variant of ConcurrentTestSuite that uses the new StreamResult API instead of
the TestResult API. ConcurrentStreamTestSuite coordinates running some number
of test/suites concurrently, with one StreamToQueue per test/suite.</p>
<p>Each test/suite gets given its own ExtendedToStreamDecorator +
TimestampingStreamResult wrapped StreamToQueue instance, forwarding onto the
StreamResult that ConcurrentStreamTestSuite.run was called with.</p>
<p>ConcurrentStreamTestSuite is a thin shim and it is easy to implement your own
specialised form if that is needed.</p>
</div>
<div class="section" id="fixturesuite">
<h3>FixtureSuite<a class="headerlink" href="#fixturesuite" title="Permalink to this headline">¶</a></h3>
<p>A test suite that sets up a <a class="reference external" href="http://pypi.python.org/pypi/fixtures">fixture</a> before running any tests, and then tears
it down after all of the tests are run. The fixture is <em>not</em> made available to
any of the tests due to there being no standard channel for suites to pass
information to the tests they contain (and we don&#8217;t have enough data on what
such a channel would need to achieve to design a good one yet - or even decide
if it is a good idea).</p>
</div>
<div class="section" id="sorted-tests">
<h3>sorted_tests<a class="headerlink" href="#sorted-tests" title="Permalink to this headline">¶</a></h3>
<p>Given the composite structure of TestSuite / TestCase, sorting tests is
problematic - you can&#8217;t tell what functionality is embedded into custom Suite
implementations. In order to deliver consistent test orders when using test
discovery (see <a class="reference external" href="http://bugs.python.org/issue16709">http://bugs.python.org/issue16709</a>), testtools flattens and
sorts tests that have the standard TestSuite, and defines a new method
sort_tests, which can be used by non-standard TestSuites to know when they
should sort their tests. An example implementation can be seen at
<tt class="docutils literal"><span class="pre">FixtureSuite.sorted_tests</span></tt>.</p>
<p>If there are duplicate test ids in a suite, ValueError will be raised.</p>
</div>
<div class="section" id="filter-by-ids">
<h3>filter_by_ids<a class="headerlink" href="#filter-by-ids" title="Permalink to this headline">¶</a></h3>
<p>Similarly to <tt class="docutils literal"><span class="pre">sorted_tests</span></tt> running a subset of tests is problematic - the
standard run interface provides no way to limit what runs. Rather than
confounding the two problems (selection and execution) we defined a method
that filters the tests in a suite (or a case) by their unique test id.
If you a writing custom wrapping suites, consider implementing filter_by_ids
to support this (though most wrappers that subclass <tt class="docutils literal"><span class="pre">unittest.TestSuite</span></tt> will
work just fine [see <tt class="docutils literal"><span class="pre">testtools.testsuite.filter_by_ids</span></tt> for details.]</p>
</div>
</div>
<div class="section" id="extensions-to-testrunner">
<h2>Extensions to TestRunner<a class="headerlink" href="#extensions-to-testrunner" title="Permalink to this headline">¶</a></h2>
<p>To facilitate custom listing of tests, <tt class="docutils literal"><span class="pre">testtools.run.TestProgram</span></tt> attempts
to call <tt class="docutils literal"><span class="pre">list</span></tt> on the <tt class="docutils literal"><span class="pre">TestRunner</span></tt>, falling back to a generic
implementation if it is not present.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">testtools for framework folk</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#extensions-to-testcase">Extensions to TestCase</a><ul>
<li><a class="reference internal" href="#custom-exception-handling">Custom exception handling</a></li>
<li><a class="reference internal" href="#controlling-test-execution">Controlling test execution</a></li>
<li><a class="reference internal" href="#test-renaming">Test renaming</a></li>
<li><a class="reference internal" href="#delayed-test-failure">Delayed Test Failure</a></li>
<li><a class="reference internal" href="#exception-formatting">Exception formatting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-placeholders">Test placeholders</a></li>
<li><a class="reference internal" href="#test-instance-decorators">Test instance decorators</a><ul>
<li><a class="reference internal" href="#decoratetestcaseresult">DecorateTestCaseResult</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extensions-to-testresult">Extensions to TestResult</a><ul>
<li><a class="reference internal" href="#streamresult">StreamResult</a></li>
<li><a class="reference internal" href="#streamsummary">StreamSummary</a></li>
<li><a class="reference internal" href="#testcontrol">TestControl</a></li>
<li><a class="reference internal" href="#streamtagger">StreamTagger</a></li>
<li><a class="reference internal" href="#streamtodict">StreamToDict</a></li>
<li><a class="reference internal" href="#extendedtostreamdecorator">ExtendedToStreamDecorator</a></li>
<li><a class="reference internal" href="#streamtoextendeddecorator">StreamToExtendedDecorator</a></li>
<li><a class="reference internal" href="#streamtoqueue">StreamToQueue</a></li>
<li><a class="reference internal" href="#timestampingstreamresult">TimestampingStreamResult</a></li>
<li><a class="reference internal" href="#streamresultrouter">StreamResultRouter</a></li>
<li><a class="reference internal" href="#testresult-addskip">TestResult.addSkip</a></li>
<li><a class="reference internal" href="#testresult-time">TestResult.time</a></li>
<li><a class="reference internal" href="#threadsafeforwardingresult">ThreadsafeForwardingResult</a></li>
<li><a class="reference internal" href="#multitestresult">MultiTestResult</a></li>
<li><a class="reference internal" href="#testresultdecorator">TestResultDecorator</a></li>
<li><a class="reference internal" href="#texttestresult">TextTestResult</a></li>
<li><a class="reference internal" href="#extendedtooriginaldecorator">ExtendedToOriginalDecorator</a></li>
<li><a class="reference internal" href="#test-doubles">Test Doubles</a></li>
<li><a class="reference internal" href="#starttestrun-and-stoptestrun">startTestRun and stopTestRun</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extensions-to-testsuite">Extensions to TestSuite</a><ul>
<li><a class="reference internal" href="#concurrenttestsuite">ConcurrentTestSuite</a></li>
<li><a class="reference internal" href="#concurrentstreamtestsuite">ConcurrentStreamTestSuite</a></li>
<li><a class="reference internal" href="#fixturesuite">FixtureSuite</a></li>
<li><a class="reference internal" href="#sorted-tests">sorted_tests</a></li>
<li><a class="reference internal" href="#filter-by-ids">filter_by_ids</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extensions-to-testrunner">Extensions to TestRunner</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="for-test-authors.html"
                        title="previous chapter">testtools for test authors</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="hacking.html"
                        title="next chapter">Contributing to testtools</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/for-framework-folk.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="hacking.html" title="Contributing to testtools"
             >next</a> |</li>
        <li class="right" >
          <a href="for-test-authors.html" title="testtools for test authors"
             >previous</a> |</li>
        <li><a href="index.html">testtools VERSION documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2010, The testtools authors.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>